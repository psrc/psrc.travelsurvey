---
title: "psrc.travelsurvey tips & tricks"
description: >
  Additional functionality for more advanced users
output: html_vignette
vignette: >
  %\VignetteIndexEntry{psrc.travelsurvey tips & tricks}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
library(psrc.travelsurvey)
library(magrittr)
library(knitr)
```

This page describes additional features of the **psrc.travelsurvey** package that are less commonly used, but helpful for specific tasks. If you have ideas regarding functionality you'd like to see implemented in the package, please contact one of the authors; it might wind up on this page later. 8^)


### Variable transformation and customization

The result of the **get_hhts()** function is simply a dataframe, and columns can be added or changed prior to calculating statistics on the object. It is fine to add or change column names and use the new or updated name in the statistical function call.


### Bulk statistic function

The **hhts_bulk_stat()** function is designed for circumstances that ask for repeated analysis of the same year & level, using various grouping variables. In place of a group_var parameter (string or character vector), it accepts group_var_list, i.e. a list in which each element is a grouping variable you want analyzed separately. There is still only one numeric target_var and one stat_type (count, sum, median, or mean), but the function can be used with lapply() for more complicated batch jobs. A key feature is that this function stores the name of the grouping variable as a column in the combined statistics table. 

This feature can be expanded to cases with multiple grouping variables, but if so, each element of the list must have the same length and only the first variable can differ across entries.  (Note that although the standard statistical functions can have any number of grouping variable combinations, sample sizes generally support only two grouping variables.)

```{r bulk statistical call, message=FALSE, eval=FALSE}
gvars <- c("res_factors_30min",
           "res_factors_afford",
           "res_factors_closefam",
           "res_factors_hwy",
           "res_factors_school",
           "res_factors_space",
           "res_factors_transit",
           "res_factors_walk",
           "res_factors_cultural")
h_2017_19c   <- get_hhts(c(2017,2019), "h", gvars)
rs_res_ftrs  <- hhts_bulk_stat(h_2017_19c, "count", group_var_list="gvars")
```


### Option to specify a non-default survey expansion weight

For those familiar with the expansion weights who want to determine the weight rather than follow the standard weight hierarchy, you will need to specify the weight name in the **vars** argument of **get_hhts()**, then use the `swgt=` option in each summary statistical call where that weight is wanted. You can use the same dataframe and switch between weights if you like, as the standard weight will be retrieved by default and will still be used in any statistical call without the `swgt=` option specified.
