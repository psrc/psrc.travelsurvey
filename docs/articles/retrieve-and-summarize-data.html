<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Retrieve and summarize data • psrc.travelsurvey</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Retrieve and summarize data">
<meta name="description" content="Retrieve and summarize household travel survey data
">
<meta property="og:description" content="Retrieve and summarize household travel survey data
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">psrc.travelsurvey</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/retrieve-and-summarize-data.html">Retrieve and summarize data</a></li>
    <li><a class="dropdown-item" href="../articles/add-standard-groupings.html">Add standard groupings</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Retrieve and summarize data</h1>
            
      

      <div class="d-none name"><code>retrieve-and-summarize-data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="works-with-travelsurveytools">Works with <strong>travelSurveyTools</strong><a class="anchor" aria-label="anchor" href="#works-with-travelsurveytools"></a>
</h2>
<p>The <strong>psrc.travelsurvey</strong> package is meant to complement
and enhance the <strong>travelSurveyTools</strong> package for PSRC
users. It delivers data in the <code>hts_data</code> format appropriate
as input to subsequent <strong>travelSurveyTools</strong> functions. It
also provides wrapper functions that provide PSRC defaults to
<strong>travelSurveyTools</strong> functions, resulting in simpler
workflows with fewer required arguments.
<strong>psrc.travelsurvey</strong> is constrained to an extent by
fitting into the <strong>travelSurveyTools</strong> system, but if you
have suggestions for other features or functions you’d find helpful,
please contact the authors and we’ll see if we can implement them.</p>
</div>
<div class="section level2">
<h2 id="data-retrieval">Data retrieval<a class="anchor" aria-label="anchor" href="#data-retrieval"></a>
</h2>
<p>Since psrc.travelsurvey uses Elmer, the agency’s central database, to
retrieve PSRC household travel survey data you’ll need to be connected
(in office or via VPN). Then use <code><a href="../reference/get_psrc_hts.html">get_psrc_hts()</a></code>, which
takes two arguments:</p>
<ul>
<li>
<strong>survey_years</strong> - a vector of one or more years; the
default is all available i.e., <code>c(2017,2019,2021,2023)</code> as of
this writing.</li>
<li>
<strong>survey_vars</strong> - a vector of variable names
(regardless of the table in which they occur)</li>
</ul>
<p>The return object is a list with separate data.table elements for
each potential unit of analysis, i.e. household (<code>hh</code>),
<code>person</code>, <code>day</code>, <code>trip</code>, and
<code>vehicle</code>. The <strong>travelSurveyTools</strong> package
workflow uses this central object for related or independent variable
summaries. It can include the full set of variables for all your
summaries, so it’s unnecessary to request separate data objects to feed
each separate summary data table. It also supports multiyear summaries
(trends/comparisons) via the <code>survey_year</code> field.</p>
<p>For efficiency, <code><a href="../reference/get_psrc_hts.html">get_psrc_hts()</a></code> only requests the
variables you specify, so you must know their precise names. A lookup
function, <code><a href="../reference/psrc_hts_varsearch.html">psrc_hts_varsearch()</a></code> can assist; it takes a
single string argument as the codebook search term and matches either
the variable name or description fields. Regular expressions are
supported for more complex searches; for example, the word boundary
operator <code>\\b</code> can be used to omit vehicle model from results
when searching for “mode”.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="fu"><a href="../reference/psrc_hts_varsearch.html">psrc_hts_varsearch</a></span><span class="op">(</span><span class="st">"\\bmode\\b"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To browse the entire variable list, open the internal data object
<code>init_variable_list</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="fu">psrc.travelsurvey</span><span class="fu">:::</span><span class="va">init_variable_list</span><span class="op">)</span></span></code></pre></div>
<p>Note: It is unnecessary to include the survey year, table ids,
weights, or survey stratification variable (<code>sample_segment</code>)
in your <code>survey_vars</code> argument; since they are necessary for
later steps, <code><a href="../reference/get_psrc_hts.html">get_psrc_hts()</a></code> includes them implicitly.
Factor variables and levels are applied from the codebook, and missing
or skip-value codes are recoded as <code>NA</code>.</p>
</div>
<div class="section level2">
<h2 id="summarization">Summarization<a class="anchor" aria-label="anchor" href="#summarization"></a>
</h2>
<p>To summarize data, use <code><a href="../reference/psrc_hts_stat.html">psrc_hts_stat()</a></code>. This has four
primary arguments, and one option. The arguments are:</p>
<ul>
<li>
<strong>hts_data</strong> - the <code>hts_data</code> object</li>
<li>
<strong>analysis_unit</strong> - string specifying the scale at
which statistics are calculated, either “hh”, “person”, “day”,“trip”, or
“vehicle”.</li>
<li>
<strong>group_vars</strong> - any grouping variables, in nesting
order (share summaries are calculated per categories of the variable
listed last).</li>
<li>
<strong>stat_var</strong> (optional) - Numeric variable if
min/max/median/mean is desired; omit for count/share summaries.</li>
</ul>
<p>As an example, we’ll retrieve the following survey variables, then do
one count/share summary, and one numeric summary. Notice,
travelSurveyTools handles the relational element of the data, so tables
lower in the organizational heirarchy (like <code>trips</code>) inherit
attributes from those above them (such as <code>hh</code>); this is a
handy feature and avoids unnecessary data duplication among tables.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://psrc.github.io/psrc.travelsurvey/">psrc.travelsurvey</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_BAG.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_BAG.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_FITS.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_FITS.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF4.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF4.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF4Image.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF4Image.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF5.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF5.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF5Image.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF5Image.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_KEA.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_KEA.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_netCDF.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_netCDF.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_PDF.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_PDF.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\ogr_FileGDB.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\ogr_FileGDB.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\ogr_MSSQLSpatial.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\ogr_MSSQLSpatial.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_BAG.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_BAG.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_FITS.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_FITS.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF4.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF4.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF4Image.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF4Image.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF5.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF5.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF5Image.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_HDF5Image.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_KEA.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_KEA.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_netCDF.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_netCDF.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_PDF.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\gdal_PDF.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\ogr_FileGDB.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\ogr_FileGDB.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\ogr_MSSQLSpatial.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="co">#&gt; Warning in CPL_gdal_init(): GDAL Error 1: Can't load requested DLL: C:\Program Files\GDAL\gdalplugins\ogr_MSSQLSpatial.dll</span></span>
<span><span class="co">#&gt; 126: The specified module could not be found.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify which variables to retrieve</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hhsize"</span>, <span class="st">"employment"</span>, <span class="st">"commute_mode"</span>, <span class="st">"dest_purpose"</span>,</span>
<span>          <span class="st">"mode_class_5"</span>, <span class="st">"distance_miles"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve the data</span></span>
<span><span class="va">hts_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_psrc_hts.html">get_psrc_hts</a></span><span class="op">(</span>survey_vars <span class="op">=</span> <span class="va">vars</span><span class="op">)</span>  <span class="co"># default includes all survey_years</span></span>
<span>  </span>
<span><span class="co"># Calculate a numeric summary, i.e. min/max/median/mean</span></span>
<span><span class="va">rs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psrc_hts_stat.html">psrc_hts_stat</a></span><span class="op">(</span><span class="va">hts_data</span>, </span>
<span>                     analysis_unit<span class="op">=</span><span class="st">"trip"</span>, </span>
<span>                     group_vars<span class="op">=</span><span class="st">"hhsize"</span>, </span>
<span>                     stat_var<span class="op">=</span><span class="st">"distance_miles"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">rs1</span><span class="op">[</span><span class="va">survey_year</span><span class="op">==</span><span class="fl">2023</span><span class="op">]</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">survey_year</span>, <span class="va">min</span>, <span class="va">max</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      hhsize count      mean   mean_moe   median</span></span>
<span><span class="co">#&gt;       &lt;ord&gt; &lt;int&gt;     &lt;num&gt;      &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 1 person 10081  6.977442  1.4370516 2.222023</span></span>
<span><span class="co">#&gt; 2: 2 people 12719 11.073412  3.2645435 3.135158</span></span>
<span><span class="co">#&gt; 3: 3 people  3915  7.009381  0.7154436 3.035398</span></span>
<span><span class="co">#&gt; 4: 4 people  3858  6.123352  0.5365826 3.197576</span></span>
<span><span class="co">#&gt; 5: 5 people  1152 23.016527 12.1648649 2.116390</span></span>
<span><span class="co">#&gt; 6: 6 people   404  5.836721  1.1624158 2.054875</span></span>
<span></span>
<span><span class="co"># Calculate a categorical summary, i.e. count/share</span></span>
<span><span class="va">rs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psrc_hts_stat.html">psrc_hts_stat</a></span><span class="op">(</span><span class="va">hts_data</span>, <span class="st">"trip"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hhsize"</span>, <span class="st">"mode_class_5"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in grepl(pattern = pattern, x = conditionMessage(cond), ...): argument</span></span>
<span><span class="co">#&gt; 'pattern' has length &gt; 1 and only the first element will be used</span></span>
<span><span class="co">#&gt; Warning: There were 82 warnings in `dplyr::summarise()`.</span></span>
<span><span class="co">#&gt; The first warning was:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `est = survey_total(vartype = "se")`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In group 5: `survey_year = 2017`, `hhsize = 1 person`, `mode_class_5 =</span></span>
<span><span class="co">#&gt;   Other`.</span></span>
<span><span class="co">#&gt; Caused by warning in `onestrat()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Stratum (PSRC - Regular-Medium) has only one PSU at stage 1</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 81 remaining warnings.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">rs2</span><span class="op">[</span><span class="va">survey_year</span><span class="op">==</span><span class="fl">2023</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">mode_class_5</span><span class="op">)</span><span class="op">==</span><span class="st">"Transit"</span><span class="op">]</span>,</span>
<span>                   <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">survey_year</span>, <span class="va">mode_class_5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      hhsize count       prop    prop_moe       est  est_moe</span></span>
<span><span class="co">#&gt;       &lt;ord&gt; &lt;int&gt;      &lt;num&gt;       &lt;num&gt;     &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 1 person   850 0.07819693 0.014343472 144804.30 27878.08</span></span>
<span><span class="co">#&gt; 2: 2 people   553 0.02450678 0.005668314 121841.55 28456.42</span></span>
<span><span class="co">#&gt; 3: 3 people   124 0.01886768 0.006262066  55321.98 18366.04</span></span>
<span><span class="co">#&gt; 4: 4 people    80 0.01031612 0.003696247  37591.82 13442.13</span></span>
<span><span class="co">#&gt; 5: 5 people    28 0.02357459 0.008536841  35762.24 12806.51</span></span>
<span><span class="co">#&gt; 6: 6 people    14 0.05805984 0.028137362  57373.12 28499.56</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="custom-variables-and-filtering">Custom variables and filtering<a class="anchor" aria-label="anchor" href="#custom-variables-and-filtering"></a>
</h2>
<p>Since each <code>hts_data</code> element is a data.table, they can be
manipulated with any combination of base r, tidyverse
(e.g. <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code>), or data.table (e.g <code>:=</code>)
syntax. The example below illustrates adding variables specific to the
<code>hts_data$trip</code> element. Notice, the inheritance capability
mentioned earlier applies to custom variables as well, so if you want to
recode a household-level variable to feature in a trip-level analysis,
just add it to <code>hts_data$hh</code> (not to
<code>hts_data$trip</code>).</p>
<p>Standard category groupings not present in the base data can be added
via the functions described in <a href="add-standard-groupings.html">the
accompanying vignette</a>. These take the entire <code>hts_data</code>
object as argument, not a specific table (the package knows which is
involved). This lends itself to piping multiple standard recodes.</p>
<p>Keep in mind that filtering any table removes records available for
subsequent analyses. Rather than manage multiple filtered copies of the
data object, you may want to create a new variable on the relevant table
with <code>NA</code> values for the records you intend to exclude from
the summary. You can then use the <code>incl_na=FALSE</code> option to
exclude that line from summary results (of particular value when you
want shares calculated from only reported categories). Here we calculate
mode split percentages for work trips only by adding a variable coded
<code>NA</code> for all non-work-related trips, then using the
<code>incl_na=FALSE</code> option to limit statistics to that
category.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use a standard variable recode to get simpler trip purpose</span></span>
<span><span class="va">hts_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hts_bin_dest_purpose.html">hts_bin_dest_purpose</a></span><span class="op">(</span><span class="va">hts_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use dplyr::mutate to add a simplified mode field &amp; work purpose specifier</span></span>
<span><span class="va">hts_data</span><span class="op">$</span><span class="va">trip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  <span class="va">hts_data</span><span class="op">$</span><span class="va">trip</span>, </span>
<span>  purpose_work <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">dest_purpose_bin4</span><span class="op">==</span><span class="st">"Work"</span> <span class="op">~</span> <span class="st">"Work"</span>,</span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dest_purpose_bin4</span><span class="op">)</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span></span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Calculate a categorical summary, i.e. count/share</span></span>
<span><span class="va">rs3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psrc_hts_stat.html">psrc_hts_stat</a></span><span class="op">(</span><span class="va">hts_data</span>, <span class="st">"trip"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"purpose_work"</span>, <span class="st">"mode_class_5"</span><span class="op">)</span>, incl_na<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in grepl(pattern = pattern, x = conditionMessage(cond), ...): argument</span></span>
<span><span class="co">#&gt; 'pattern' has length &gt; 1 and only the first element will be used</span></span>
<span><span class="co">#&gt; Warning: There were 49 warnings in `dplyr::summarise()`.</span></span>
<span><span class="co">#&gt; The first warning was:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `est = survey_total(vartype = "se")`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In group 4: `survey_year = 2017`, `purpose_work = "Work"`, `mode_class_5 =</span></span>
<span><span class="co">#&gt;   Bike`.</span></span>
<span><span class="co">#&gt; Caused by warning in `onestrat()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Stratum (PSRC - Oversample-Low) has only one PSU at stage 1</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 48 remaining warnings.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">rs3</span><span class="op">[</span><span class="va">survey_year</span><span class="op">==</span><span class="fl">2023</span><span class="op">]</span>,</span>
<span>                   <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">survey_year</span>, <span class="va">purpose_work</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    mode_class_5 count        prop    prop_moe        est    est_moe</span></span>
<span><span class="co">#&gt;           &lt;ord&gt; &lt;int&gt;       &lt;num&gt;       &lt;num&gt;      &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:        Drive  3211 0.865739816 0.018028620 1835881.03 125651.228</span></span>
<span><span class="co">#&gt; 2:      Transit   402 0.029027564 0.007653030   61555.62  16093.543</span></span>
<span><span class="co">#&gt; 3:         Walk   728 0.079432698 0.013730924  168444.35  29070.846</span></span>
<span><span class="co">#&gt; 4:         Bike   153 0.008963787 0.002837518   19008.54   5922.878</span></span>
<span><span class="co">#&gt; 5:        Other   118 0.016836136 0.008717198   35702.58  18613.062</span></span></code></pre></div>
<p>Note: <strong>travelSurveyTools</strong> summary functions require
additional preparatory steps that <strong>psrc.travelsurvey</strong>
handles for you, for simplicity. To use native
<strong>travelSurveyTools</strong> summary functions, you’ll need to
handle these extra steps yourself, since
<strong>travelSurveyTools</strong> does not have a dependency on the
<strong>psrc.travelsurvey</strong> package.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Suzanne Childress, Michael Jensen, Joanne Lin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
