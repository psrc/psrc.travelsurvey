<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Retrieve and summarize data • psrc.travelsurvey</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Retrieve and summarize data">
<meta name="description" content="Retrieve and summarize household travel survey data
">
<meta property="og:description" content="Retrieve and summarize household travel survey data
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">psrc.travelsurvey</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/retrieve-and-summarize-data.html">Retrieve and summarize data</a></li>
    <li><a class="dropdown-item" href="../articles/add-standard-groupings.html">Add standard groupings</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Retrieve and summarize data</h1>
            
      

      <div class="d-none name"><code>retrieve-and-summarize-data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="works-with-travelsurveytools">Works with <strong>travelSurveyTools</strong><a class="anchor" aria-label="anchor" href="#works-with-travelsurveytools"></a>
</h2>
<p>The <strong>psrc.travelsurvey</strong> package is meant to complement
and enhance the <strong>travelSurveyTools</strong> package for PSRC
users. It delivers data in the <code>hts_data</code> format appropriate
as input to subsequent <strong>travelSurveyTools</strong> functions. It
also provides wrapper functions that provide PSRC defaults to
<strong>travelSurveyTools</strong> functions, resulting in simpler
workflows with fewer required arguments.
<strong>psrc.travelsurvey</strong> is constrained to an extent by
fitting into the <strong>travelSurveyTools</strong> system, but if you
have suggestions for other features or functions you’d find helpful,
please contact the authors and we’ll see if we can implement them.</p>
</div>
<div class="section level2">
<h2 id="data-retrieval">Data retrieval<a class="anchor" aria-label="anchor" href="#data-retrieval"></a>
</h2>
<p>Since psrc.travelsurvey uses Elmer, the agency’s central database, to
retrieve PSRC household travel survey data you’ll need to be connected
(in office or via VPN). Then use <code><a href="../reference/get_psrc_hts.html">get_psrc_hts()</a></code>, which
takes two arguments:</p>
<ul>
<li>
<strong>survey_years</strong> - a vector of one or more years; the
default is all available i.e., <code>c(2017,2019,2021,2023)</code> as of
this writing.</li>
<li>
<strong>survey_vars</strong> - a vector of variable names
(regardless of the table in which they occur)</li>
</ul>
<p>The return object is a list with separate data.table elements for
each potential unit of analysis, i.e. household (<code>hh</code>),
<code>person</code>, <code>day</code>, <code>trip</code>, and
<code>vehicle</code>. The <strong>travelSurveyTools</strong> package
workflow uses this central object for related or independent variable
summaries. It can include the full set of variables for all your
summaries, so it’s unnecessary to request separate data objects to feed
each separate summary data table. It also supports multiyear summaries
(trends/comparisons) via the <code>survey_year</code> field.</p>
<p>For efficiency, <code><a href="../reference/get_psrc_hts.html">get_psrc_hts()</a></code> only requests the
variables you specify, so you must know their precise names. A lookup
function, <code><a href="../reference/psrc_hts_varsearch.html">psrc_hts_varsearch()</a></code> can assist; it takes a
single string argument as the codebook search term and matches either
the variable name or description fields. Regular expressions are
supported for more complex searches; for example, the word boundary
operator <code>\\b</code> can be used to omit vehicle model from results
when searching for “mode”.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="fu"><a href="../reference/psrc_hts_varsearch.html">psrc_hts_varsearch</a></span><span class="op">(</span><span class="st">"\\bmode\\b"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To browse the entire variable list, open the internal data object
<code>init_variable_list</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="fu">psrc.travelsurvey</span><span class="fu">:::</span><span class="va">init_variable_list</span><span class="op">)</span></span></code></pre></div>
<p>Note: It is unnecessary to include the survey year, table ids,
weights, or survey stratification variable (<code>sample_segment</code>)
in your <code>survey_vars</code> argument; since they are necessary for
later steps, <code><a href="../reference/get_psrc_hts.html">get_psrc_hts()</a></code> includes them implicitly.
Factor variables and levels are applied from the codebook, and missing
or skip-value codes are recoded as <code>NA</code>.</p>
</div>
<div class="section level2">
<h2 id="summarization">Summarization<a class="anchor" aria-label="anchor" href="#summarization"></a>
</h2>
<p>To summarize data, use <code><a href="../reference/psrc_hts_stat.html">psrc_hts_stat()</a></code>. This has four
primary arguments, and one option. The arguments are:</p>
<ul>
<li>
<strong>hts_data</strong> - the <code>hts_data</code> object</li>
<li>
<strong>analysis_unit</strong> - string specifying the scale at
which statistics are calculated, either “hh”, “person”, “day”,“trip”, or
“vehicle”.</li>
<li>
<strong>group_vars</strong> - any grouping variables, in nesting
order (share summaries are calculated per categories of the variable
listed last).</li>
<li>
<strong>stat_var</strong> (optional) - Numeric variable if
min/max/median/mean is desired; omit for count/share summaries.</li>
</ul>
<p>As an example, we’ll retrieve the following survey variables, then do
one count/share summary, and one numeric summary. Notice,
travelSurveyTools handles the relational element of the data, so tables
lower in the organizational heirarchy (like <code>trips</code>) inherit
attributes from those above them (such as <code>hh</code>); this is a
handy feature and avoids unnecessary data duplication among tables.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://psrc.github.io/psrc.travelsurvey/">psrc.travelsurvey</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify which variables to retrieve</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hhsize"</span>, <span class="st">"employment"</span>, <span class="st">"commute_mode"</span>, <span class="st">"dest_purpose_cat"</span>, </span>
<span>          <span class="st">"mode_characterization"</span>, <span class="st">"distance_miles"</span>, <span class="st">"duration_minutes"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve the data</span></span>
<span><span class="va">hts_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_psrc_hts.html">get_psrc_hts</a></span><span class="op">(</span>survey_vars <span class="op">=</span> <span class="va">vars</span><span class="op">)</span>  <span class="co"># default includes all survey_years</span></span>
<span></span>
<span><span class="co"># Calculate a numeric summary, i.e. min/max/median/mean</span></span>
<span><span class="va">rs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psrc_hts_stat.html">psrc_hts_stat</a></span><span class="op">(</span><span class="va">hts_data</span>, </span>
<span>                     analysis_unit<span class="op">=</span><span class="st">"trip"</span>, </span>
<span>                     group_vars<span class="op">=</span><span class="st">"hhsize"</span>, </span>
<span>                     stat_var<span class="op">=</span><span class="st">"distance_miles"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">rs1</span><span class="op">[</span><span class="va">survey_year</span><span class="op">==</span><span class="fl">2023</span><span class="op">]</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">survey_year</span>, <span class="va">min</span>, <span class="va">max</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      hhsize count      mean   mean_moe   median</span></span>
<span><span class="co">#&gt;       &lt;ord&gt; &lt;int&gt;     &lt;num&gt;      &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 1 person 10075  6.380222  0.8284701 2.169828</span></span>
<span><span class="co">#&gt; 2: 2 people 11871 13.174915  3.0272559 3.311287</span></span>
<span><span class="co">#&gt; 3: 3 people  3517  8.357221  0.9016603 4.094215</span></span>
<span><span class="co">#&gt; 4: 4 people  3595 10.254066  5.6922574 3.233616</span></span>
<span><span class="co">#&gt; 5: 5 people  1018 32.329314 19.3722674 2.761995</span></span>
<span><span class="co">#&gt; 6: 6 people   371  5.709866  0.8525478 3.046583</span></span>
<span></span>
<span><span class="co"># Calculate a categorical summary, i.e. count/share</span></span>
<span><span class="va">rs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psrc_hts_stat.html">psrc_hts_stat</a></span><span class="op">(</span><span class="va">hts_data</span>, <span class="st">"trip"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hhsize"</span>, <span class="st">"mode_characterization"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">rs2</span><span class="op">[</span><span class="va">survey_year</span><span class="op">==</span><span class="fl">2023</span> <span class="op">&amp;</span> <span class="va">mode_characterization</span><span class="op">==</span><span class="st">"Transit"</span><span class="op">]</span>, </span>
<span>                   <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">survey_year</span>, <span class="va">mode_characterization</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      hhsize count       prop    prop_moe       est   est_moe</span></span>
<span><span class="co">#&gt;       &lt;ord&gt; &lt;int&gt;      &lt;num&gt;       &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 1 person   908 0.08090005 0.012606740 173635.72 28466.102</span></span>
<span><span class="co">#&gt; 2: 2 people   563 0.02056404 0.004167832  88135.46 17783.128</span></span>
<span><span class="co">#&gt; 3: 3 people   165 0.01946050 0.005394446  32299.75  8864.421</span></span>
<span><span class="co">#&gt; 4: 4 people   205 0.04214847 0.009085101 162495.97 35391.190</span></span>
<span><span class="co">#&gt; 5: 5 people    77 0.06091950 0.015838454 131608.22 34802.763</span></span>
<span><span class="co">#&gt; 6: 6 people    49 0.10200039 0.026777949 140783.94 38384.352</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="custom-variables-and-filtering">Custom variables and filtering<a class="anchor" aria-label="anchor" href="#custom-variables-and-filtering"></a>
</h2>
<p>Since each <code>hts_data</code> element is a data.table, they can be
manipulated with any combination of base r, tidyverse
(e.g. <code>mutate()</code>), or data.table (e.g <code>:=</code>)
syntax. Additionally, standard category groupings not present in the
base data can be added via the functions described in <a href="add-standard-groupings.html">the accompanying vignette</a>.</p>
<p>Keep in mind that filtering any table removes records available for
subsequent analyses. Rather than manage multiple filtered copies of the
data object, you may want to create a new variable on the relevant table
with <code>NA</code> values for the records you intend to exclude from
the summary. You can then use the <code>incl_na=FALSE</code> option to
exclude that line from summary results (of particular value when you
want shares calculated from only reported categories). Here we will add
a dichotomous <code>worker</code> variable, then calculate shares with
<code>NA</code> values excluded (they would otherwise comprise about 20
percent of the total).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add the worker variable </span></span>
<span><span class="va">hts_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hts_bin_worker.html">hts_bin_worker</a></span><span class="op">(</span><span class="va">hts_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate a categorical summary, i.e. count/share</span></span>
<span><span class="va">rs3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psrc_hts_stat.html">psrc_hts_stat</a></span><span class="op">(</span><span class="va">hts_data</span>, <span class="st">"person"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"survey_year"</span>, <span class="st">"worker"</span><span class="op">)</span>, incl_na<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rs3</span><span class="op">)</span></span>
<span><span class="co">#&gt;    survey_year     worker count      prop   prop_moe      est  est_moe</span></span>
<span><span class="co">#&gt;          &lt;int&gt;     &lt;fctr&gt; &lt;int&gt;     &lt;num&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:        2017     Worker 22410 0.7063481 0.01354619  9673300 288287.3</span></span>
<span><span class="co">#&gt; 2:        2017 Not Worker  6665 0.2936519 0.01354619  4021506 211522.6</span></span>
<span><span class="co">#&gt; 3:        2019     Worker 28498 0.7312252 0.01065477 15595816 389674.2</span></span>
<span><span class="co">#&gt; 4:        2019 Not Worker  7616 0.2687748 0.01065477  5732519 247627.2</span></span>
<span><span class="co">#&gt; 5:        2021     Worker  5766 0.6997530 0.01119662  6801352 151145.4</span></span>
<span><span class="co">#&gt; 6:        2021 Not Worker  3273 0.3002470 0.01119662  2918295 112326.6</span></span></code></pre></div>
<p>Note: <strong>travelSurveyTools</strong> summary functions require
additional preparatory steps that <strong>psrc.travelsurvey</strong>
handles for you, for simplicity. To use native
<strong>travelSurveyTools</strong> summary functions, you’ll need to
handle these extra steps yourself, since
<strong>travelSurveyTools</strong> does not have a dependency on the
<strong>psrc.travelsurvey</strong> package.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Suzanne Childress, Michael Jensen, Joanne Lin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
