<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Learn how to quickly generate statistics from PSRC's signature survey
">
<title>Calculate Household Travel Survey summaries • psrc.travelsurvey</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Household Travel Survey summaries">
<meta property="og:description" content="Learn how to quickly generate statistics from PSRC's signature survey
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">psrc.travelsurvey</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/calculate_hhts_summaries.html">Calculate Household Travel Survey summaries</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="calculate_hhts_summaries_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Calculate Household Travel Survey summaries</h1>
            
      
      
      <div class="d-none name"><code>calculate_hhts_summaries.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="role-and-extent-of-the-psrc-household-travel-survey">Role and extent of the PSRC Household Travel Survey<a class="anchor" aria-label="anchor" href="#role-and-extent-of-the-psrc-household-travel-survey"></a>
</h2>
<p>[Add text here.]</p>
</div>
<div class="section level2">
<h2 id="retrieve-household-travel-survey-data-get_hhts">Retrieve Household Travel Survey data: <em>get_hhts()</em><a class="anchor" aria-label="anchor" href="#retrieve-household-travel-survey-data-get_hhts"></a>
</h2>
<p>The <strong>psrc.travelsurvey</strong> package is designed to facilitate analysis using the survey data at stored geographic scales. Data analysis with the <strong>psrccensus</strong> package involves two steps:</p>
<p>The first step consists of retrieving the data of interest via the <strong>get_hhts()</strong> function. The arguments are:</p>
<ul>
<li>
<strong>dyear</strong> - aka data year; if weights exist for a combination of years, you can specify them as a vector, e.g. c(2017,2019)</li>
<li>
<strong>level</strong> - the unit of analysis: “p” for persons, “h” for households, “t” for trips, or “v” for vehicles</li>
<li>
<strong>vars</strong> - either a single variable or a character vector of variables (including geographic units), with lowercase names precisely matching the data dictionary</li>
</ul>
<p>The result of <strong>get_hhts()</strong> is a dataframe that includes the set of potential sampling weights that match your requested variables, as well as those variables themselves. Any manipulation of the object must take the weights into account. Also note that categorical variables are encoded as factor datatype and must be recast (using as.character() ) before reclassifying them into custom categories.</p>
<p><strong>get_hhts()</strong> can be called once for each combination of <strong>dyear - level</strong> you intend to use. For example, if you want to calculate both household statistics and population statistics from the same survey (year), you will still need to use <strong>get_hhts()</strong> once for households (level=“h”) and a second time for persons (‘level’=“p”). When you invoke <strong>get_hhts()</strong> we suggest you assign a name that helps you differentiate between whatever <strong>dyear - level</strong> combinations are relevant to your analysis.</p>
<p>Although most Household Travel Survey variables are specific to a particular unit, household attributes can be associated with people, days, trips and vehicles; person attributes can be associated with days and trips, which can also be associated with one another.</p>
</div>
<div class="section level2">
<h2 id="generate-summary-statistics">Generate summary statistics<a class="anchor" aria-label="anchor" href="#generate-summary-statistics"></a>
</h2>
<p>The second step in an analysis involves calculating summary statistics from the result of the prior step. Since the Household Travel Survey is a stratified sample, summary statistics must use a particular sampling weight in order to be accurately expanded to the full population.</p>
<p>There are four relevant statistical functions, along with a summary function that gives all four in the same table.</p>
<div class="line-block">         <strong>hhts_count()</strong> - provides both counts and percentages<br>
         <strong>hhts_sum()</strong><br>
         <strong>hhts_median()</strong><br>
         <strong>hhts_mean()</strong><br>
         <strong>hhts_summary()</strong> - provides all the above statistics in one table</div>
<p>The arguments for each summary function are identical:</p>
<ul>
<li>
<strong>df</strong> - The dataframe returned by <strong>get_hhts()</strong>
</li>
<li>
<strong>target_var</strong> - For sum, median or mean, the numeric variable to be summarized</li>
<li>
<strong>group_vars</strong> - Any grouping variable/s (if multiple, as a character vector)</li>
<li>
<strong>geographic_unit</strong> - A standard geography; this is basically another grouping variable that is subtotaled and ordered in the result set</li>
</ul>
<p>Argument names can be omitted (saving keystrokes) if arguments are provided in proper sequence; you may prefer to be explicit to avoid confusing them.</p>
<p>Note that a <strong>target_var</strong> must be numeric and any <strong>group_vars</strong> must not be continuous (i.e., they must be categorical or interval). The target_var argument is ignored by the count function (for which the numeric variable is implicit), but is allowed since some scripting will use identical arguments (e.g. map functions).</p>
<p><strong>psrc.travelsurvey</strong> handles the selection and application of sampling weights internally, to deliver estimates of the full population. It also provides the tabulated margin of error (MOE) for each estimate in a separately labeled ’_moe’ column.</p>
<div class="section level3">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<p>As an example, to calculate the median trip distance, you would use the following function calls:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t_2017_19a</span>      <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_hhts.html">get_hhts</a></span><span class="op">(</span>dyear<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2017</span>,<span class="fl">2019</span><span class="op">)</span>,
                            level<span class="op">=</span><span class="st">"t"</span>,
                            vars<span class="op">=</span><span class="st">"trip_path_distance"</span><span class="op">)</span>

<span class="va">rs_median_dist</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hhts_stat.html">hhts_median</a></span><span class="op">(</span>df<span class="op">=</span><span class="va">t_2017_19a</span>, 
                               target_var<span class="op">=</span><span class="st">"trip_path_distance"</span><span class="op">)</span></code></pre></div>
<p>To calculate by a subgroup category (here, travel mode), use the optional grouping variable argument.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t_2017_19b</span>             <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_hhts.html">get_hhts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2017</span>,<span class="fl">2019</span><span class="op">)</span>, <span class="st">"t"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mode_1"</span>, <span class="st">"trip_path_distance"</span><span class="op">)</span><span class="op">)</span>
<span class="va">rs_median_dist_x_mode</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hhts_stat.html">hhts_median</a></span><span class="op">(</span><span class="va">t_2017_19b</span>, <span class="st">"trip_path_distance"</span>, <span class="st">"mode_1"</span><span class="op">)</span></code></pre></div>
<p>The count function tabulates the number of units of analysis, depending on the level you specified in <strong>get_hhts</strong>. The result represents the region (via weighting), not the survey sample. If you intend to count things other than households, people, travel days, trips or vehicles, you should use the ‘total’ function instead, which sums the target variable. The hhts_count() function also provides percentages. Notice that because the target_var is implicit for counts, any group_vars argument must be specified.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">h_2017_19a</span>      <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_hhts.html">get_hhts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2017</span>,<span class="fl">2019</span><span class="op">)</span>, <span class="st">"h"</span>, <span class="st">"hh_race_category"</span><span class="op">)</span>
<span class="va">rs_race_region</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hhts_stat.html">hhts_count</a></span><span class="op">(</span><span class="va">h_2017_19a</span>, group_vars<span class="op">=</span><span class="st">"hh_race_category"</span><span class="op">)</span></code></pre></div>
<p>To report by a subregional geography, you must include that variable in the <strong>vars</strong> argument of <strong>get_hhts()</strong> . It makes sense to request as many attributes per <strong>dyear-level</strong> combination you need, as you can run statistical functions independently on that same dataframe–including multiple geographic scales. Each statistical call will also provide the regional total as the last line, for context/comparison.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>h_<span class="dv">2017</span>_19b       &lt;-<span class="st"> </span><span class="kw">get_hhts</span>(<span class="kw">c</span>(<span class="dv">2017</span>,<span class="dv">2019</span>), <span class="st">"h"</span>, <span class="kw">c</span>(<span class="st">"hh_race_category"</span>, <span class="st">"final_home_tract"</span>, <span class="st">"home_city_name"</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a>rs_race_tract    &lt;-<span class="st"> </span><span class="kw">hhts_count</span>(h_<span class="dv">2017</span>_19b, <span class="dt">group_vars=</span><span class="st">"hh_race_category"</span>, <span class="dt">geographic_unit=</span><span class="st">"final_home_tract"</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a>rs_race_city     &lt;-<span class="st"> </span><span class="kw">hhts_count</span>(h_<span class="dv">2017</span>_19b, <span class="dt">group_vars=</span><span class="st">"hh_race_category"</span>, <span class="dt">geographic_unit=</span><span class="st">"home_city_name"</span>)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="sample-sizes-confidence-and-error-margins">Sample sizes, confidence, and error margins<a class="anchor" aria-label="anchor" href="#sample-sizes-confidence-and-error-margins"></a>
</h2>
<p>Although <strong>psrc.travelsurvey</strong> allows you to specify multiple grouping variables, you’ll need to keep in mind that there are limits to what can be usefully determined from small subsets of respondents. To draw responsible conclusions, you’ll need to examine the margins of error (MOE) <strong>psrc.travelsurvey</strong> calculates along with the estimate.</p>
<p>If there are very few respondents in a category combination, the margin of error may be beyond calculation (NaN, or ‘not a number’), or so large that the estimate itself has little practical value. In these cases, you may want to potentially analyze dimensions of the data separately rather than in combination.</p>
<div class="section level3">
<h3 id="determining-difference">Determining difference<a class="anchor" aria-label="anchor" href="#determining-difference"></a>
</h3>
<p>Is there an actual difference between two statistics generated from Household Travel Survey data? To know, you’ll need to examine the margins of error. As a rule of thumb, if there is overlap in the 90 percent confidence intervals of the two estimates, you cannot conclude the values are different. To perform a more careful test, you can calculate the Z score: <span class="math display">\[\frac{|Est_{1} - Est_{2}|}{\sqrt{MOE_{est1}^2 + MOE_{est2}^2}}\]</span> There is only a meaningful difference between two estimates if the Z score is greater than 1. This test can be applied between different years, or between PUMS and ACS. However, please remember Census warns against drawing comparisons between estimates generated from different spans (e.g. 1yr with 5yr), especially if they overlap (as the same observations may be exist in both).</p>
<p>The <code><a href="../reference/z_score.html">z_score()</a></code> convenience function performs this calculation:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>t_<span class="dv">2017</span>_19c  &lt;-<span class="st"> </span><span class="kw">get_hhts</span>(<span class="kw">c</span>(<span class="dv">2017</span>,<span class="dv">2019</span>), <span class="st">"t"</span>, <span class="kw">c</span>(<span class="st">"mode_1"</span>,<span class="st">"trip_path_distance"</span>,<span class="st">"travel_time"</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>rs          &lt;-<span class="st"> </span><span class="kw">hhts_median</span>(t_<span class="dv">2017</span>_19c, <span class="st">"travel_time"</span>, <span class="st">"mode_1"</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a>c1          &lt;-<span class="st"> </span>rs[<span class="dv">1</span>,(<span class="kw">ncol</span>(rs)<span class="op">-</span><span class="dv">1</span>)<span class="op">:</span><span class="kw">ncol</span>(rs)]       <span class="co"># First-line estimate and its MOE (as numeric vector)</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>c2          &lt;-<span class="st"> </span>rs[<span class="dv">3</span>,(<span class="kw">ncol</span>(rs)<span class="op">-</span><span class="dv">1</span>)<span class="op">:</span><span class="kw">ncol</span>(rs)]       <span class="co"># Third-line estimate and its MOE (as numeric vector)</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="kw">z_score</span>(c1, c2)                                  <span class="co"># A true difference is indicated by score &gt; 1</span></span></code></pre></div>
<hr>
<p><strong><em>NOTE FOR POWER USERS:</em></strong> For those familiar with the expansion weights who want to determine the weight rather than follow the standard weight hierarchy, you will need to specify the weight name in the <strong>vars</strong> argument of <strong>get_hhts()</strong>, then use the <code>swgt=</code> option in each summary statistical call where that weight is wanted. You can use the same dataframe and switch between weights if you like, as the standard weight will be retrieved by default and will still be used in any statistical call without the <code>swgt=</code> option specified.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Craig Helmann, Christy Lam, Suzanne Childress, Michael Jensen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
